#######################################
#									 #
######## Security Strike Forces #######
#									 #
#######################################

create_security_forces_country = {
	# save_event_target_as = main_country
	if = {
		limit = { any_country = { has_relation_flag = { who = root flag = security_strike_force } } }
		random_country = {
			limit = { has_relation_flag = { who = root flag = security_strike_force } }
			save_event_target_as = security_forces_country
		}
	} else = {
		create_country = {
			name = "Security Forces"
			type = security_forces
			flag = {
				icon = { category = "spherical" file = "flag_spherical_3.dds" }
				background= { category = "backgrounds" file = "diagonal.dds" }
				colors = { "black" "blue" "null" "null" }
			}
			effect = {
				save_event_target_as = security_forces_country
				every_country = {
					limit = { has_communications = root }
					establish_communications_no_message = prev
				}
				set_country_flag = security_strike_force
				set_relation_flag = { who = root flag = security_strike_force }
				set_subject_of = { who = root subject_type = space_dimestication }
			}
		}
	}
}

deploy_security_escort_fleet = {
	create_security_forces_country = yes
	event_target:ship_escorted = {
		solar_system = { star = { save_event_target_as = spawn_location } }
		fleet = { save_event_target_as = ship_escorted_fleet }
	}
	create_fleet = {
		name = "Security Strike Forces"
		effect = {
			set_owner = root # event_target:main_country
			while = { count = 10 create_ship = { name = random random_existing_design = corvette } }
			while = { count = 10 random = { chance = 50 create_ship = { name = random random_existing_design = corvette } } }
			set_location = { target = event_target:spawn_location distance = 325 angle = random }
			set_fleet_stance = passive
			set_fleet_flag = security_escort_fleet
			save_event_target_as = security_fleet
		}
	}
	# event_target:security_fleet = {
	last_created_fleet = {
		set_owner = event_target:security_forces_country auto_follow_fleet = { target = event_target:ship_escorted_fleet attack_fleet = no }
	}
}
